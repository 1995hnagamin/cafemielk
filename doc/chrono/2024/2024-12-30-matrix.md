# ADR 1: 行列データは継承された構造体で表現する

この Architectural Decision Record では，
Cafemielk for Common Lisp (`clcm/`) において行列データ構造を表現する方法について決定する．

+ Author: hnagamin
+ Issued: 2024-12-30
+ Status: Draft

## Context

- 複数種類の行列データ構造をストレスなく扱えるようにしたい．
  ここで行列データ構造とは，密行列の二次配列表現，CSR (compressed sparse rows)，
  H行列などを含む．
- 総称関数の仕組みを活用して，同名の関数で別の実装にスイッチできるようにしたい．
- たとえば行列ベクトル積の実装は行列データ構造ごとに異なるが，
  これらを統一的なインターフェースで扱い，用いるべき実装を自動的に決定できれば便利である．
- 行列ベクトル積など，やや重い処理を対象とするため，実装のスイッチのコストを
  実行時に払っても目をつぶってよいと考える．

## Decision

- `matrix` 構造体は，行数 `nrow` と列数 `ncol` をもつ．
- 個々の疎行列データ構造は，`matrix` 構造体を継承する．

これは以下の利点をもつ．

- 構造体はクラスより低コスト．
- 行列を扱う状況の99%は，行数と列数を必要とする．
  残り1%は多様であって，1通りのやり方ではうまくいかない．
- 継承の仕組みは総称関数と相性がよい．
- 多重継承が必要になるとは考えにくい．

## Consideration

### クラスを使う

- 構造を変更した場合に再コンパイルしやすい．
- 構造体より柔軟．
  もっとも，クラス特有の機能が必要とは考えにくい．

一方で以下の欠点がある．
- クラスは構造体より重い．

### 行数，列数，エントリからなる構造体とする

- 「継承よりもコンポジションを好む」に合致する．
- 行数と列数を必要としない処理を行う際に有利．

一方で以下の欠点がある．

- 総称関数の仕組みと相性が悪い．

## Consequences

-  
- (-) 常に

## References

----
Permanent ID of this document: `055726a1f4d4c48f81eabd97407a18f369e75ace`.
Date: 2024-12-30.
